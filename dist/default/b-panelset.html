<element name="b-panelset" attributes="selected">
    <style>:root {

    /* gradient experiment: remove borders & 3d effect for testing; */
    /*--b-button-primary-bg: linear-gradient(
        to bottom, 
        color(var(--b-button-primary-bg-color) hue(-8deg) saturation(+16%)) 0%, 
        color(var(--b-button-primary-bg-color) hue(-8deg) saturation(+8%)) 4%, 
        var(--b-button-primary-bg-color) 100%
    );*/
}
        b-panelset {
            display: block;
            border: 1px solid transparent;
                border-color: rgb(214, 214, 214);
                border-radius: 2px 2px 0 0;
                box-shadow: 0 5px 10px rgba(0,0,0,.2);
        }
        b-panelset > b-panel {
            border: none;
        }
        b-panel:not(:first-child) {
            border-radius: 0;
        }
        b-panelset b-panel:not([open])::shadow .b-panel-content-wrapper {
            display: none;
        }
        /* For browsers without native shadow DOM */
        b-panelset b-panel:not([open]) .b-panel-content-wrapper { 
            display: none;
        }
    </style>
    <script>
        (function(){
            Bosonic.register({
                mixins: [Bosonic.Selection, Bosonic.Transitions],

                get tabBar() {
                    return this.querySelector('b-panel-tabs');
                },

                createdCallback: function() {
                    this.registeredPanels = [];
                    var tabBar = document.createElement('b-panel-tabs');
                    this.insertBefore(tabBar, this.firstChild || null);
                    
                    if (!this.hasAttribute('selected')) {
                        this.setAttribute('selected', 0);
                    }
                },

                registerPanel: function(panel) {
                    var title = panel.querySelector('b-panel-title'),
                        tab = title.cloneNode(true);

                    tab.__panelIndex
                    tab.tabIndex = -1;
                    tab.setAttribute('aria-controls', panel.contentElement.id);
                    tab.setAttribute('aria-selected', 'false');
                    this.tabBar.appendChild(tab);
                    
                    var newLength = this.registeredPanels.push(panel),
                        newIndex = newLength - 1;

                    tab.__panelIndex = newIndex;

                    if (this.selectedItemIndex === newIndex) {
                        panel.setAttribute('open', '');
                        this.activateTab(tab);
                    }
                    
                    this.listen(title, 'tap', 'handleTitleTap');
                    this.listen(tab, 'tap', 'handleTabTap');
                },

                selectedChanged: function (oldIndex, newIndex) {
                    if (!oldIndex) return;
                    this.applyDeselection(oldIndex);
                    this.applySelection(newIndex);
                },

                applySelection: function(index) {
                    var panel = this.getPanel(index);
                    if (!this.hasAttribute('entry-transition') || !this.hasTransition(this.getAttribute('entry-transition'))) {
                        panel.open();
                        return;
                    }
                    this.playTransition(this.getAttribute('entry-transition'), panel.contentWrapper).end(function() {
                        panel.open();
                    });
                },

                applyDeselection: function(index) {
                    var panel = this.getPanel(index);
                    if (!this.hasAttribute('exit-transition') || !this.hasTransition(this.getAttribute('exit-transition'))) {
                        panel.close();
                        return;
                    }
                    this.playTransition(this.getAttribute('exit-transition'), panel.contentWrapper).end(function() {
                        panel.close();
                    });
                },

                activateTab: function(tab, mustFocus) {
                    if (mustFocus) tab.focus();
                    tab.classList.add('active');
                    tab.tabIndex = 0;
                    tab.setAttribute('aria-selected', 'true');
                },

                disactivateTab: function(tab) {
                    tab.classList.remove('active');
                    tab.tabIndex = -1;
                    tab.setAttribute('aria-selected', 'false');
                },

                handleTitleTap: function(e) {
                    var panelIndex =  this.getPanels().indexOf(e.target.parentNode);
                    if (panelIndex !== -1) {
                        this.select(panelIndex);
                    }
                },

                handleTabTap: function(e) {
                    var panelIndex =  e.target.__panelIndex;
                    if (panelIndex !== -1) {
                        this.select(panelIndex);
                    }
                },

                getActivePanel: function() {
                    return this.selectedItem;
                },

                getPanel: function(index) {
                    return this.getItem(index);
                },

                getPanels: function() {
                    return this.getItems();
                },

                getItems: function() {
                    return this.registeredPanels;
                }
            });
        })();
    </script>
</element>

<element name="b-panel-tabs" attributes="selected">
    <style>:root {

    /* gradient experiment: remove borders & 3d effect for testing; */
    /*--b-button-primary-bg: linear-gradient(
        to bottom, 
        color(var(--b-button-primary-bg-color) hue(-8deg) saturation(+16%)) 0%, 
        color(var(--b-button-primary-bg-color) hue(-8deg) saturation(+8%)) 4%, 
        var(--b-button-primary-bg-color) 100%
    );*/
}
        b-panel-tabs {
            display: block;
            /*background-color: var(--b-tabs-bg-color);*/
            border-bottom: 1px solid #ddd;
            box-shadow: 0 3px 3px -2px rgba(0,0,0,.1);
        }
        b-panelset:not([preferreddisplay='tabs']) b-panel-tabs {
            display: none;
        }
        b-panelset[preferreddisplay='tabs'] > b-panel {
            border-top: none;
        }
        b-panelset[preferreddisplay='tabs'] > b-panel > b-panel-title {
            display: none;
        }
        b-panel-tabs > b-panel-title {
            display: inline-block;
            font-size: 1.1em; /* must be > 1 so that b-panel-tabs bottom border stays visible... */
            cursor: default;
            padding: 0.5em 1em;
            border-bottom: 3px solid transparent;
            color: rgb(89, 89, 89);
            background-color: white;
            box-shadow: none;
        }
        b-panel-tabs > b-panel-title.active {
            border-bottom-color: #689caf;
            font-weight: var(--b-tab-active-font-weight);
            color: #333;
        }
    </style>
    <script>
        (function(){
            Bosonic.register({});
        })();
    </script>
</element>
<element name="b-panel-tab">
    <style>:root {

    /* gradient experiment: remove borders & 3d effect for testing; */
    /*--b-button-primary-bg: linear-gradient(
        to bottom, 
        color(var(--b-button-primary-bg-color) hue(-8deg) saturation(+16%)) 0%, 
        color(var(--b-button-primary-bg-color) hue(-8deg) saturation(+8%)) 4%, 
        var(--b-button-primary-bg-color) 100%
    );*/
}
        b-panel-tab {
            display: inline-block;
            cursor: default;
            padding: 0.5em 1em;
            border-bottom: 3px solid transparent;
            color: rgb(89, 89, 89);
        }
        b-panel-tab.active {
            border-bottom-color: #689caf;
            font-weight: var(--b-tab-active-font-weight);
            color: #333;
        }
    </style>
    <script>
        (function(){
            Bosonic.register({
                hasFocus: function() {
                    return this === document.activeElement;
                }
            });
        })();
    </script>
</element>