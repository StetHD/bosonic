<element name="b-panelset" attributes="selected">
    <style>:root {

    /* gradient experiment: remove borders & 3d effect for testing; */
    /*--b-button-primary-bg: linear-gradient(
        to bottom, 
        color(var(--b-button-primary-bg-color) hue(-8deg) saturation(+16%)) 0%, 
        color(var(--b-button-primary-bg-color) hue(-8deg) saturation(+8%)) 4%, 
        var(--b-button-primary-bg-color) 100%
    );*/
}
        b-panel:not(:first-child) {
            border-radius: 0;
        }
    </style>
    <script>
        (function(){
            Bosonic.register({
                mixins: [Bosonic.Selection],

                get tabBar() {
                    return this.querySelector('b-panel-tabs');
                },

                createdCallback: function() {
                    var tabBar = document.createElement('b-panel-tabs');
                    this.insertBefore(tabBar, this.firstChild || null);
                    this.getPanels().forEach(function(panel) { this.registerPanel(panel); }, this);
                    if (!this.hasAttribute('selected')) {
                        this.selectFirst();
                    }
                    this.getActivePanel().setAttribute('open', '');
                },

                registerPanel: function(panel) {
                    var title = panel.querySelector('b-panel-title'),
                        tab = title.cloneNode(true);
                    
                    this.tabBar.appendChild(tab);
                    panel.setAttribute('expandable', '');
                    this.listen(title, 'tap', 'handleTitleTap');
                    //this.listen(tab, 'tap', 'handleTabTap');
                },

                selectedChanged: function (oldIndex, newIndex) {
                    if (!oldIndex) return;
                    this.applyDeselection(oldIndex);
                    this.applySelection(newIndex);
                },

                applySelection: function(index) {
                    var panel = this.getPanel(index);
                    panel.expand();
                },

                applyDeselection: function(index) {
                    var panel = this.getPanel(index);
                    panel.collapse();
                },

                handleTitleTap: function(e) {
                    var panelIndex =  this.getPanels().indexOf(e.target.parentNode);
                    if (panelIndex !== -1) {
                        this.select(panelIndex);
                    }
                },

                // handleTabTap: function(e) {
                //     var panelIndex =  this.getPanels().indexOf(e.target.parentNode);
                //     if (panelIndex !== -1) {
                //         this.select(panelIndex);
                //     }
                // },

                getActivePanel: function() {
                    return this.selectedItem;
                },

                getPanel: function(index) {
                    return this.getItem(index);
                },

                getPanels: function() {
                    return this.getItems();
                },

                getItems: function() {
                    return Array.prototype.slice.call(this.querySelectorAll('b-panel'), 0);
                }
            });
        })();
    </script>
</element>

<element name="b-panel-tabs" attributes="selected">
    <style>:root {

    /* gradient experiment: remove borders & 3d effect for testing; */
    /*--b-button-primary-bg: linear-gradient(
        to bottom, 
        color(var(--b-button-primary-bg-color) hue(-8deg) saturation(+16%)) 0%, 
        color(var(--b-button-primary-bg-color) hue(-8deg) saturation(+8%)) 4%, 
        var(--b-button-primary-bg-color) 100%
    );*/
}
        b-panel-tabs {
            display: block;
            background-color: var(--b-tabs-bg-color);
            border-bottom: 1px solid #ddd;
            box-shadow: 0 3px 3px -2px rgba(0,0,0,.1);
        }
        /*b-panelset:not([preferreddisplay='tabs']) b-panel-tabs {
            display: none;
        }*/
        b-panel-tabs > b-panel-title {
            display: inline-block;
            cursor: default;
            padding: 0.5em 1em;
            border-bottom: 3px solid transparent;
            color: rgb(89, 89, 89);
            background-color: white;
            box-shadow: none;
        }
        b-panel-tabs > b-panel-title.active {
            border-bottom-color: #689caf;
            font-weight: var(--b-tab-active-font-weight);
            color: #333;
        }
    </style>
    <script>
        (function(){
            Bosonic.register({});
        })();
    </script>
</element>
<element name="b-panel-tab">
    <style>:root {

    /* gradient experiment: remove borders & 3d effect for testing; */
    /*--b-button-primary-bg: linear-gradient(
        to bottom, 
        color(var(--b-button-primary-bg-color) hue(-8deg) saturation(+16%)) 0%, 
        color(var(--b-button-primary-bg-color) hue(-8deg) saturation(+8%)) 4%, 
        var(--b-button-primary-bg-color) 100%
    );*/
}
        b-panel-tab {
            display: inline-block;
            cursor: default;
            padding: 0.5em 1em;
            border-bottom: 3px solid transparent;
            color: rgb(89, 89, 89);
        }
        b-panel-tab.active {
            border-bottom-color: #689caf;
            font-weight: var(--b-tab-active-font-weight);
            color: #333;
        }
    </style>
    <script>
        (function(){
            Bosonic.register({
                hasFocus: function() {
                    return this === document.activeElement;
                }
            });
        })();
    </script>
</element>