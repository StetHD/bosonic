<element name="b-switch" extends="input">
    <style>/* was :host when using shadowDOM */
        .b-switch-container {
            display: inline-block;
            vertical-align: bottom;
            top: 1px;
            position: relative;
            min-width: 60px;
            height: 24px;
            overflow: hidden;
            border: 1px solid rgb(214, 214, 214);
            border-radius: 2px;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            -webkit-transition: border 0.130s ease-out;
            transition: border 0.130s ease-out;
            cursor: pointer;
            font-size: 10px;
        }
        .b-switch-container.on {
            border: 1px solid rgb(105, 148, 163);
        }
        .b-switch-container + input[type='checkbox'] {
            display: none;
        }
        .b-switch {
            position: absolute;
            left: calc(-100% + 24px);
            width: calc(200% - 24px);
            height: 100%;
            overflow: hidden;
            white-space: nowrap;
            -webkit-transition: left 0.130s ease-out;
            transition: left 0.130s ease-out;
        }
        .b-switch.on {
            left: 0;
        }
        .b-switch > * {
            float: left;
        }
        .b-switch-on, .b-switch-off {
            width: 50%;
            height: 100%;
            text-align: center;
            box-sizing: border-box;
            line-height: 24px;
        }
        .b-switch-on {
            padding-right: calc(24px / 2);
            background-color: #689caf;
            color: #fff;
            box-shadow: 0 3px 5px rgba(0,0,0,.125) inset;
        }
        .b-switch-off {
            padding-left: calc(24px / 2);
            background-color: #bfbfbf;
            color: #333;
            box-shadow: 0 3px 5px rgba(0,0,0,.125) inset;
        }
        .b-switch-thumb {
            position: absolute;
            left: calc(50% - 24px / 2);
            width: 24px;
            height: 100%;
            border-radius: 1px;
            background-color: #e0e0e0;
            box-shadow: 0 1px 0 rgba(0, 0, 0, .3), 0 1px 0 rgba(255, 255, 255, .3) inset;
        }
    </style>
    <template>
        <div class="b-switch">
            <span class="b-switch-on"></span>
            <span class="b-switch-thumb"></span>
            <span class="b-switch-off"></span>
        </div>
    </template>
    <script>
        (function(){
            Bosonic.register({
                __automaticTemplating: false,

                get noCaption() {
                    return this.hasCustomAttribute('nocaption');
                },

                get onCaption() {
                    return this.getCustomAttribute('oncaption') || 'ON';
                },

                get offCaption() {
                    return this.getCustomAttribute('offcaption') || 'OFF';
                },

                get label() {
                    if (this.parentNode.nodeName === 'LABEL') return this.parentNode;
                },

                createdCallback: function() {
                    // As we want to extend a native input element, we can't use shadowDOM because it won't work with 
                    // non-native ShadowDOM browsers. Therefore we insert our markup before the input and use aria-hidden
                    // so that our markup will be hidden to users using assistive technologies
                    var container = document.createElement('div');
                    container.classList.add('b-switch-container');
                    container.setAttribute('aria-hidden', 'true');
                    container.appendChild(document.importNode(this.__template.content, true));
                    this.parentNode.insertBefore(container, this);
                    this.root = container;

                    // if there is an englobing label, we let it do its job and we don't touch the checked attribute
                    if (this.label) {
                        this.listen(this.label, 'tap', 'onLabelTap');
                    } else {
                        this.listen(this.root, 'tap', 'onTap');
                    }

                    if (!this.noCaption) {
                        this.root.querySelector('.b-switch-on').textContent = this.onCaption;
                        this.root.querySelector('.b-switch-off').textContent = this.offCaption;
                    }
                    
                    if (this.hasAttribute('checked')) this.toggleSwitch(true);
                },

                onTap: function(e) {
                    this.toggle(!this.checked);
                },

                onLabelTap: function(e) {
                    this.toggleSwitch(!this.checked);
                },

                check: function() {
                    this.toggle(true);
                },

                uncheck: function() {
                    this.toggle(false);
                },

                toggle: function(value) {
                    this.toggleSwitch(value);
                    this.checked = value;
                },

                toggleSwitch: function(value) {
                    this.toggleClass('on', value);
                    this.toggleClass('on', value, this.root.querySelector('.b-switch'));
                }
            });
        })();
    </script>
</element>