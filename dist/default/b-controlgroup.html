<element name="b-controlgroup">
    <style>:root {

    /* gradient experiment: remove borders & 3d effect for testing; */
    /*--b-button-primary-bg: linear-gradient(
        to bottom, 
        color(var(--b-button-primary-bg-color) hue(-8deg) saturation(+16%)) 0%, 
        color(var(--b-button-primary-bg-color) hue(-8deg) saturation(+8%)) 4%, 
        var(--b-button-primary-bg-color) 100%
    );*/
}
        /* layout */
        b-controlgroup {
            opacity: 1;
            position: relative;
            display: inline-block;
            vertical-align: middle;
        }
        b-controlgroup > button,
        b-controlgroup > label {
            position: relative;
            float: left;
        }
        b-controlgroup[vertical] > button,
        b-controlgroup[vertical] > label {
            display: block;
            float: none;
            width: 100%;
            max-width: 100%;
        }
        /* rounded corners adjustments */
        b-controlgroup:not([vertical]) > button:first-child:not(:last-child),
        b-controlgroup:not([vertical]) > label:first-child:not(:last-child) {
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        b-controlgroup > button:not(:first-child):not(:last-child),
        b-controlgroup > label:not(:first-child):not(:last-child) {
            border-radius: 0;
        }
        b-controlgroup:not([vertical]) > button:last-child:not(:first-child),
        b-controlgroup:not([vertical]) > label:last-child:not(:first-child) {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }
        b-controlgroup[vertical] > button:first-child:not(:last-child),
        b-controlgroup[vertical] > label:first-child:not(:last-child) {
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }
        b-controlgroup[vertical] > button:last-child:not(:first-child),
        b-controlgroup[vertical] > label:last-child:not(:first-child) {
            border-top-right-radius: 0;
            border-top-left-radius: 0;
        }
        /* very basic labels & inputs styling */
        b-controlgroup > label {
            border: 1px solid #ccc;
        }
        b-controlgroup > label.active {
            background-color: #ccc;
        }
        b-controlgroup input[type=checkbox],
        b-controlgroup input[type=radio] {
            position: absolute;
            clip: rect(0,0,0,0);
            pointer-events: none;
        }
    </style>
    <script>
        Bosonic.register({
            hostAttributes: {
                role: 'group'
            },

            createdCallback: function() {
                if (this.isWrappingInputs()) {
                    this.listen(this, 'tap', 'onTap');
                    this.listen(this, 'click', 'onClick');
                    this.activateLabels();
                }
            },

            detachedCallback: function() {
                if (this.isWrappingInputs()) {
                    this.unlisten(this, 'tap', 'onTap');
                    this.listen(this, 'click', 'onClick');
                }
            },

            onTap: function(event) {
                // the target must be a label. If not, the user probably didn't read the instructions...
                var label = event.target,
                    input = label.querySelector('input');
                if (input.type === 'radio' && input.checked !== true) {
                    input.checked = true;
                    var active = this.querySelector('.active');
                    if (active) {
                        active.classList.remove('active');
                        active.querySelector('input').checked = false;
                    }
                    label.classList.add('active');
                } else if (input.type === 'checkbox') {
                    input.checked = !input.checked;
                    this.toggleClass('active', input.checked, label);
                }
                return false;
            },

            // sadly, we must prevent click events. For a reason unknown, calling 
            // preventDefault() in the onTap method doesn't work, even with preventDefault forwarding 
            // feature added to gestures mixin...
            onClick: function(event) {
                event.preventDefault();
            },

            activateLabels: function() {
                [].forEach.call(this.querySelectorAll('label'), function(label) {
                    var input = label.querySelector('input');
                    if (input && input.checked === true) {
                        label.classList.add('active');
                    }
                });
            },

            isWrappingInputs: function() {
                return this.querySelectorAll('input[type=checkbox], input[type=radio]').length !== 0;
            }
        });
    </script>
</element>