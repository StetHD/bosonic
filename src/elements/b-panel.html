<element name="b-panel">
    <template>
        <style>
            :host {
                display: block;
                position: relative;
                border: 1px solid transparent;
                border-color: var(--b-panel-border);
                border-radius: var(--b-panel-border-radius);
                box-shadow: var(--b-panel-shadow);
                background-color: var(--b-panel-content-bg);
                overflow: hidden;
            }
            .b-panel-content-wrapper {
                margin: 0;
                padding: 0;
            }
            .b-panel-content {
                display: block;
                padding: var(--b-panel-content-padding);
                margin: var(--bosonic-3d-effect-shadow-size) 0 0 0;
            }
            .b-panel-remove {
                position: absolute;
                top: var(--b-panel-title-padding-vertical);
                right: var(--b-panel-title-padding-horizontal);
                opacity:.4;
                cursor: pointer;
                border: none;
                background: none;
            }
            .b-panel-resize {
                display: block;
                border: none;
                position: absolute;
                background-color: transparent;
                bottom: 0px;
                right: 0px;
                padding: 0;
                margin: 0;
                line-height: 0.8em;
            }
            .b-panel-resize:hover {
                cursor: se-resize;
            }
        </style>
        <content select="b-panel-title" tabindex="0"></content>
        <div class="b-panel-content-wrapper">
            <div class="b-panel-content" tabindex="0">
                <content></content>
            </div>
        </div>
    </template>
    <script>
        (function(){
            var lastUID = 0;

            function uid() {
                return 'bp-' + (++lastUID);
            }

            Bosonic.register({
                mixins: [Bosonic.Transitions],

                get titleElement() {
                    return this.querySelector('b-panel-title');
                },

                get contentElement() {
                    return this.shadowRoot.querySelector('.b-panel-content');
                },

                get contentWrapper() {
                    return this.shadowRoot.querySelector('.b-panel-content-wrapper');
                },

                set open(value) {
                    this._opened = !!value;
                    this.contentWrapper.style.display = this._opened ? 'block' : 'none';
                    this.toggleAriaState();
                },

                get open() {
                    return this._opened;
                },

                createdCallback: function() {
                    if (!this.contentElement.id) this.contentElement.id = uid();
                    if (this.parentNode.nodeName === 'B-PANELSET') {
                        this.parentNode.registerPanel(this);
                        return;
                    }
                    if (this.hasCustomAttribute('expandable')) {
                        this.open = this.hasAttribute('open');
                        if (this.titleElement) {
                            this.titleElement.setAttribute('aria-controls', this.contentElement.id);
                            this.listen(this.titleElement, 'tap', 'toggleExpansionState');
                        }
                    }
                    if (this.hasCustomAttribute('removable')) this.inject(Bosonic.Removable);
                    if (this.hasCustomAttribute('resizable')) this.inject(Bosonic.Resizable);
                    if (this.hasCustomAttribute('draggable')) {
                        this.inject(Bosonic.Draggable, { 
                            handle: this.titleElement,
                            containment: this.getCustomAttribute('drag-containment')
                        });
                    }
                },

                toggleExpansionState: function() {
                    this.open ? this.hide() : this.show();
                },

                show: function() {
                    this.open = true;
                    if (this.hasAttribute('open-transition')) {
                        this.playTransition('open', this.contentWrapper).end();
                    }
                },

                hide: function() {
                    if (!this.hasAttribute('close-transition')) {
                        this.open = false;
                    } else {
                        this.playTransition('close', this.contentWrapper).end(function() {
                            this.open = false;
                        }.bind(this));
                    }
                },

                toggleAriaState: function() {
                    this.titleElement.setAttribute('aria-expanded', this.open ? 'true' : 'false');
                    this.contentElement.setAttribute('aria-hidden', this.open ? 'false' : 'true');
                    this.contentElement.tabIndex = this.open ? 0 : -1;
                }
            });
        })();
    </script>
</element>

<element name="b-panel-title">
    <style>
        b-panel-title {
            display: block;
            padding: var(--b-panel-title-padding);
            margin: 0;
            font-size: var(--b-panel-title-font-size);
            font-weight: var(--b-panel-title-font-weight);
            line-height: var(--bosonic-line-height-base);
            background-color: var(--b-panel-title-bg);
            color: var(--b-panel-title-color);
            box-shadow: var(--b-panel-title-3d-effect);
        }
        b-panel[expandable] > b-panel-title:after {
            float: right;
            content: "\25B4";
        }
        b-panel[expandable][open] > b-panel-title:after {
            float: right;
            content:'\25BE';
        }
    </style>
    <script>
        (function(){
            Bosonic.register({
                hostAttributes: {
                    tabindex: 0
                }
            });
        })();
    </script>
</element>