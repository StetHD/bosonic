<element name="b-listbox">
    <style>
        b-listbox {
            display: block;
            padding: 0;
            margin: 0;
            z-index: 1000;
            /* minimum styling */
            background-color: white;
            border: var(--b-dropdown-border);
        }
        b-listbox > b-item > a {
            display: block;
            white-space: nowrap;
        }
        b-listbox {
            background-color: white;
            border: var(--b-dropdown-border);
            border-radius: var(--b-dropdown-border-radius);
            box-shadow: var(--b-dropdown-shadow);
            margin-top: 1px;
            min-width: 140px;
        }
        b-listbox > b-item:hover, b-listbox > b-item:focus {
            background-color: var(--b-dropdown-item-hover-bg);
            outline: none;
        }
        b-listbox > b-item[aria-selected='true'] {
            font-weight: 600;
        }
        b-listbox > b-item > a {
            color: var(--bosonic-default-font-color);
            text-decoration: none;
            font-size: var(--b-dropdown-item-font-size);
            padding: var(--b-dropdown-item-padding);
            display: block;
            white-space: nowrap;
        }
        b-listbox > b-item > a:hover {
            text-decoration: none;
        }
        b-listbox > hr {
            margin: 0;
            border: 0;
            border-top: var(--b-dropdown-border);
        }
    </style>
    <script>
        Bosonic.register({
            mixins: [Bosonic.Selection],

            hostAttributes: {
                role: 'listbox',
                tabindex: 0
            },

            keyBindings: {
                'up down': 'cycleFocus',
                'esc': 'echap',
                'enter': 'enter'
            },

            get items() {
                return Array.prototype.slice.call(this.querySelectorAll('b-item'), 0);
            },

            get focusedItem() {
                return this.querySelector(':focus');
            },

            get focusedItemIndex() {
                if (!this.focusedItem) return -1;
                return this.items.indexOf(this.focusedItem);
            },

            createdCallback: function() {
                this.items.forEach(function(item) {
                    item.setAttribute('role', 'option');
                    item.tabIndex = -1;
                });
                this.querySelector('b-item').tabIndex = 0;
                this.listen(this, 'focus', 'onHostFocus');
            },

            onHostFocus: function() {
                this.focusFirstItem();
            },

            cycleFocus: function(e, key) {
                if (!this.focusedItem) {
                    this.focusFirstItem();
                    return;
                }
                var focusedItemIndex = this.focusedItemIndex,
                    lastItemIndex = this.items.length - 1;
                if (key === 'down' && focusedItemIndex < lastItemIndex) {
                    this.items[focusedItemIndex + 1].focus();
                } else if (key === 'up' && focusedItemIndex > 0) {
                    this.items[focusedItemIndex - 1].focus();
                }
            },

            focusFirstItem: function() {
               this.items[0].focus();
            },

            enter: function(e) {
                if (!this.focusedItem) return;
                this.selectedItems.indexOf(this.focusedItemIndex) !== -1 ? this.unselect(this.focusedItemIndex) : this.select(this.focusedItemIndex);
            },

            echap: function() {
                // if (!this.open) {
                //     return;
                // }
                // this.hide();
                // this.button.focus();
            }
        });
    </script>
</element>
<element name="b-item">
    <style>
        b-item {
            display: block;
        }
    </style>
    <script>
        Bosonic.register({});
    </script>
</element>